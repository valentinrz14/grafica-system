generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
}

model User {
  id              String   @id @default(cuid())
  email           String   @unique
  passwordHash    String?  @map("password_hash")
  createdAt       DateTime @default(now()) @map("created_at")
  updatedAt       DateTime @updatedAt @map("updated_at")
  role            UserRole @default(USER)
  firstName       String?  @map("first_name")
  googleId        String?  @unique @map("google_id")
  lastName        String?  @map("last_name")
  oauthProvider   String?  @map("oauth_provider")
  phoneNumber     String?  @map("phone_number")
  profileComplete Boolean  @default(false) @map("profile_complete")
  orders          Order[]

  @@index([googleId])
  @@map("users")
}

model Order {
  id         String      @id @default(cuid())
  userEmail  String?     @map("user_email")
  status     OrderStatus @default(PENDING)
  totalPrice Float       @map("total_price")
  options    Json
  createdAt  DateTime    @default(now()) @map("created_at")
  updatedAt  DateTime    @updatedAt @map("updated_at")
  userId     String?     @map("user_id")
  comment    String?
  pickupDate DateTime?   @map("pickup_date")
  pickupTime String?     @map("pickup_time")
  files      OrderFile[]
  user       User?       @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([status])
  @@index([createdAt])
  @@index([userId])
  @@map("orders")
}

model OrderFile {
  id           String   @id @default(cuid())
  orderId      String   @map("order_id")
  fileUrl      String   @map("file_url")
  fileName     String   @map("file_name")
  originalName String   @map("original_name")
  pages        Int      @default(1)
  createdAt    DateTime @default(now()) @map("created_at")
  order        Order    @relation(fields: [orderId], references: [id], onDelete: Cascade)

  @@index([orderId])
  @@map("order_files")
}

model PricingConfig {
  id               String   @id @default(cuid())
  basePrice        Float    @map("base_price")
  colorMultiplier  Float    @map("color_multiplier")
  duplexMultiplier Float    @map("duplex_multiplier")
  createdAt        DateTime @default(now()) @map("created_at")
  updatedAt        DateTime @updatedAt @map("updated_at")

  @@map("pricing_config")
}

enum OrderStatus {
  PENDING
  PRINTING
  DONE
  EXPIRED
}

enum UserRole {
  USER
  ADMIN
}
